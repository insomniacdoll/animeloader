# animeloader é¡¹ç›®è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

animeloader æ˜¯ä¸€ä¸ªç”¨äºŽè®¢é˜…åŠ¨ç”»å‘å¸ƒå’Œç®¡ç†åŠ¨ç”»ä¸‹è½½å†…å®¹çš„ Python åº”ç”¨ç¨‹åºã€‚ç³»ç»Ÿé‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡ç«¯æž¶æž„ï¼Œæ”¯æŒç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œç•Œé¢ç®¡ç†åŠ¨ç”»è®¢é˜…ã€æŸ¥çœ‹ä¸‹è½½çŠ¶æ€å’Œé…ç½®å®šæ—¶ä»»åŠ¡ã€‚

### 1.1 å½“å‰å®žçŽ°çŠ¶æ€

> **æ³¨æ„**ï¼šæœ¬é¡¹ç›®å¤„äºŽå¼€å‘é˜¶æ®µï¼Œä»¥ä¸‹ä¸ºæ ¸å¿ƒåŠŸèƒ½çš„å®žçŽ°çŠ¶æ€ï¼š
>
> - âœ… **å·²å®Œæˆ**ï¼šåŠ¨ç”»ç®¡ç†ï¼ˆæ·»åŠ ã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰ã€RSSæºç®¡ç†ï¼ˆæ·»åŠ ã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰ã€æ™ºèƒ½è§£æžåŠŸèƒ½ï¼ˆèœœæŸ‘è®¡åˆ’ç½‘ç«™ï¼‰ã€é“¾æŽ¥ç®¡ç†ã€ä¸‹è½½å™¨ç®¡ç†ã€ä¸‹è½½ä»»åŠ¡ç®¡ç†ã€å®šæ—¶ä»»åŠ¡è°ƒåº¦ã€åŸºç¡€APIæ¡†æž¶
> - ðŸš§ **å¼€å‘ä¸­**ï¼šRSSæºè‡ªåŠ¨æ£€æŸ¥ã€é“¾æŽ¥è‡ªåŠ¨ä¸‹è½½ã€ä¸‹è½½çŠ¶æ€åŒæ­¥
> - ðŸ“‹ **è®¡åˆ’ä¸­**ï¼šå¤šä¸‹è½½å™¨æ”¯æŒã€å‘½ä»¤è¡Œäº¤äº’ç•Œé¢

### 1.2 æ ¸å¿ƒåŠŸèƒ½

- **åŠ¨ç”»è®¢é˜…ç®¡ç†**ï¼šæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æŸ¥è¯¢åŠ¨ç”»è®¢é˜…ä¿¡æ¯ âœ…
- **RSSæºç®¡ç†**ï¼šæ·»åŠ ã€åˆ é™¤ã€æ›´æ–°ã€æŸ¥è¯¢RSSè®¢é˜…æº âœ…
- **æ™ºèƒ½è§£æžåŠŸèƒ½**ï¼š
  - æ”¯æŒä»ŽåŠ¨ç”»ç½‘ç«™é“¾æŽ¥è‡ªåŠ¨è§£æžåŠ¨ç”»ä¿¡æ¯å’ŒRSSè®¢é˜…é“¾æŽ¥ âœ…
  - å½“å‰æ”¯æŒ https://mikanani.me/ï¼ˆèœœæŸ‘è®¡åˆ’ï¼‰âœ…
  - åŠ¨ç”»æ™ºèƒ½è§£æžæ”¯æŒè¿žé”æ“ä½œï¼Œè§£æžåŠ¨ç”»åŽå¯è‡ªåŠ¨è§£æžRSSæº âœ…
  - RSSæºæ™ºèƒ½è§£æžéœ€æŒ‡å®šæ‰€å±žåŠ¨ç”» âœ…
  - è§£æžç»“æžœæœ‰å¤šä¸ªæ—¶æä¾›äº¤äº’å¼é€‰æ‹©ç•Œé¢ âœ…
  - æ”¯æŒå¤šé€‰å’ŒèŒƒå›´é€‰æ‹©ï¼ˆå¦‚ 1,2,3 æˆ– 1-3ï¼‰âœ…
- **é“¾æŽ¥ç®¡ç†**ï¼šæŸ¥çœ‹ã€è¿‡æ»¤ä¸‹è½½é“¾æŽ¥ï¼Œæ”¯æŒå¤šç§é“¾æŽ¥ç±»åž‹ï¼ˆmagnetã€ed2kç­‰ï¼‰âœ…
- **ä¸‹è½½å™¨ç®¡ç†**ï¼šæ”¯æŒå¤šç§ä¸‹è½½å™¨ï¼ˆaria2ã€pikpakç­‰ï¼‰ï¼Œæ”¯æŒæ‰©å±•æ–°çš„ä¸‹è½½å™¨ âœ…
- **ä¸‹è½½ä»»åŠ¡ç®¡ç†**ï¼šé’ˆå¯¹æ¯ä¸ªé“¾æŽ¥åˆ›å»ºä¸‹è½½ä»»åŠ¡ï¼Œæ”¯æŒæš‚åœã€æ¢å¤ã€å–æ¶ˆ âœ…
- **å®šæ—¶ä¸‹è½½ä»»åŠ¡**ï¼šè‡ªåŠ¨æ£€æµ‹æ–°å‘å¸ƒçš„åŠ¨ç”»å¹¶ä¸‹è½½ âœ…
- **ä¸‹è½½çŠ¶æ€ç›‘æŽ§**ï¼šå®žæ—¶æŸ¥çœ‹ä¸‹è½½è¿›åº¦å’ŒçŠ¶æ€ï¼Œæ”¯æŒåŒæ­¥å¤–éƒ¨ä¸‹è½½å™¨çŠ¶æ€ âœ…
- **å‘½ä»¤è¡Œäº¤äº’**ï¼šæä¾›å‹å¥½çš„ CLI ç•Œé¢è¿›è¡Œæ“ä½œ ðŸ“‹

### 1.3 ç›®æ ‡ç”¨æˆ·

- åŠ¨ç”»çˆ±å¥½è€…
- éœ€è¦è‡ªåŠ¨åŒ–ä¸‹è½½åŠ¨ç”»å†…å®¹çš„ç”¨æˆ·

### 1.1 æ ¸å¿ƒåŠŸèƒ½

- **åŠ¨ç”»è®¢é˜…ç®¡ç†**ï¼šæ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹åŠ¨ç”»è®¢é˜…ä¿¡æ¯
- **RSSæºç®¡ç†**ï¼šæ·»åŠ ã€åˆ é™¤ã€æ£€æŸ¥RSSè®¢é˜…æº
- **æ™ºèƒ½è§£æžåŠŸèƒ½**ï¼š
  - æ”¯æŒä»ŽåŠ¨ç”»ç½‘ç«™é“¾æŽ¥è‡ªåŠ¨è§£æžåŠ¨ç”»ä¿¡æ¯å’ŒRSSè®¢é˜…é“¾æŽ¥
  - å½“å‰æ”¯æŒ https://mikanani.me/ï¼ˆèœœæŸ‘è®¡åˆ’ï¼‰
  - åŠ¨ç”»æ™ºèƒ½è§£æžæ”¯æŒè¿žé”æ“ä½œï¼Œè§£æžåŠ¨ç”»åŽå¯è‡ªåŠ¨è§£æžRSSæº
  - RSSæºæ™ºèƒ½è§£æžéœ€æŒ‡å®šæ‰€å±žåŠ¨ç”»
  - è§£æžç»“æžœæœ‰å¤šä¸ªæ—¶æä¾›äº¤äº’å¼é€‰æ‹©ç•Œé¢
  - æ”¯æŒå¤šé€‰å’ŒèŒƒå›´é€‰æ‹©ï¼ˆå¦‚ 1,2,3 æˆ– 1-3ï¼‰
- **é“¾æŽ¥ç®¡ç†**ï¼šæŸ¥çœ‹ã€è¿‡æ»¤ä¸‹è½½é“¾æŽ¥ï¼Œæ”¯æŒå¤šç§é“¾æŽ¥ç±»åž‹ï¼ˆmagnetã€ed2kç­‰ï¼‰
- **ä¸‹è½½å™¨ç®¡ç†**ï¼šæ”¯æŒå¤šç§ä¸‹è½½å™¨ï¼ˆaria2ã€pikpakç­‰ï¼‰ï¼Œæ”¯æŒæ‰©å±•æ–°çš„ä¸‹è½½å™¨
- **ä¸‹è½½ä»»åŠ¡ç®¡ç†**ï¼šé’ˆå¯¹æ¯ä¸ªé“¾æŽ¥åˆ›å»ºä¸‹è½½ä»»åŠ¡ï¼Œæ”¯æŒæš‚åœã€æ¢å¤ã€å–æ¶ˆ
- **å®šæ—¶ä¸‹è½½ä»»åŠ¡**ï¼šè‡ªåŠ¨æ£€æµ‹æ–°å‘å¸ƒçš„åŠ¨ç”»å¹¶ä¸‹è½½
- **ä¸‹è½½çŠ¶æ€ç›‘æŽ§**ï¼šå®žæ—¶æŸ¥çœ‹ä¸‹è½½è¿›åº¦å’ŒçŠ¶æ€ï¼Œæ”¯æŒåŒæ­¥å¤–éƒ¨ä¸‹è½½å™¨çŠ¶æ€
- **å‘½ä»¤è¡Œäº¤äº’**ï¼šæä¾›å‹å¥½çš„ CLI ç•Œé¢è¿›è¡Œæ“ä½œ

### 1.2 ç›®æ ‡ç”¨æˆ·

- åŠ¨ç”»çˆ±å¥½è€…
- éœ€è¦è‡ªåŠ¨åŒ–ä¸‹è½½åŠ¨ç”»å†…å®¹çš„ç”¨æˆ·

## 2. æŠ€æœ¯æ ˆ

### 2.1 å¼€å‘çŽ¯å¢ƒ

- **Python**: 3.12+
- **æ“ä½œç³»ç»Ÿ**: macOS / Linux / Windows

### 2.2 æ ¸å¿ƒä¾èµ–

- **æ•°æ®åº“**: SQLite
- **ORM**: SQLAlchemy
- **CLIæ¡†æž¶**: cmd2 (å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ¡†æž¶)
- **ç•Œé¢ç¾ŽåŒ–**: rich (å®¢æˆ·ç«¯å‘½ä»¤è¡Œäº¤äº’ç¾ŽåŒ–)
- **HTTPå®¢æˆ·ç«¯**: requests
- **RSSè§£æž**: feedparser
- **HTMLè§£æž**: beautifulsoup4 (ç”¨äºŽç½‘ç«™æ™ºèƒ½è§£æž)
- **äº¤äº’å¼é€‰æ‹©**: inquirer (ç”¨äºŽå‘½ä»¤è¡Œäº¤äº’é€‰æ‹©)
- **ä»»åŠ¡è°ƒåº¦**: APScheduler
- **æ—¥å¿—**: logging
- **aria2 RPC**: aria2p (å¯é€‰ï¼Œç”¨äºŽaria2ä¸‹è½½å™¨)
- **é…ç½®ç®¡ç†**: pyyaml

### 2.3 å¯é€‰ä¾èµ–

- **é…ç½®ç®¡ç†**: pyyaml / toml
- **APIæ¡†æž¶**: FastAPI (å¦‚éœ€æä¾› REST API)
- **æµ‹è¯•æ¡†æž¶**: pytest

## 3. ç³»ç»Ÿæž¶æž„

### 3.1 æ•´ä½“æž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚         â”‚                 â”‚
â”‚   CLI Client    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤   Server        â”‚
â”‚                 â”‚  HTTP   â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   SQLite DB     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Downloaders   â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                              â”‚  â”‚   aria2   â”‚  â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                              â”‚  â”‚   pikpak  â”‚  â”‚
                              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç›®å½•ç»“æž„

```
animeloader/
â”œâ”€â”€ IFLOW.md              # é¡¹ç›®è¯´æ˜Ž
â”œâ”€â”€ DESIGN.md             # è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ LICENSE               # è®¸å¯è¯
â”œâ”€â”€ requirements.txt      # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ server_config.yaml    # æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ï¼ˆä»…ç”¨äºŽå¼€å‘ï¼‰
â”œâ”€â”€ client_config.yaml    # å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼ˆä»…ç”¨äºŽå¼€å‘ï¼‰
â”œâ”€â”€ server/               # æœåŠ¡ç«¯ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py           # æœåŠ¡ç«¯å…¥å£
â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ anime.py      # åŠ¨ç”»æ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ rss_source.py # RSSæºæ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ link.py       # é“¾æŽ¥æ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ downloader.py # ä¸‹è½½å™¨é…ç½®æ¨¡åž‹
â”‚   â”‚   â””â”€â”€ download.py   # ä¸‹è½½ä»»åŠ¡æ¨¡åž‹
â”‚   â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ rss_service.py        # RSSæºç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ link_service.py       # é“¾æŽ¥ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ download_service.py   # ä¸‹è½½æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ downloader_service.py # ä¸‹è½½å™¨ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ scheduler_service.py  # è°ƒåº¦æœåŠ¡
â”‚   â”‚   â””â”€â”€ smart_parser_service.py # æ™ºèƒ½è§£æžæœåŠ¡
â”‚   â”œâ”€â”€ link_parsers/    # é“¾æŽ¥è§£æžå™¨ï¼ˆå¯æ‰©å±•ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_parser.py      # åŸºç¡€è§£æžå™¨
â”‚   â”‚   â”œâ”€â”€ magnet_parser.py    # ç£åŠ›é“¾æŽ¥è§£æžå™¨
â”‚   â”‚   â””â”€â”€ ed2k_parser.py      # ed2ké“¾æŽ¥è§£æžå™¨
â”‚   â”œâ”€â”€ site_parsers/     # ç½‘ç«™æ™ºèƒ½è§£æžå™¨ï¼ˆå¯æ‰©å±•ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_site_parser.py # åŸºç¡€ç½‘ç«™è§£æžå™¨
â”‚   â”‚   â””â”€â”€ mikan_parser.py     # èœœæŸ‘è®¡åˆ’è§£æžå™¨
â”‚   â”œâ”€â”€ downloaders/       # ä¸‹è½½å™¨å®žçŽ°ï¼ˆå¯æ‰©å±•ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_downloader.py   # åŸºç¡€ä¸‹è½½å™¨æŽ¥å£
â”‚   â”‚   â”œâ”€â”€ aria2_downloader.py  # aria2ä¸‹è½½å™¨
â”‚   â”‚   â””â”€â”€ pikpak_downloader.py # pikpakç¦»çº¿ä¸‹è½½å™¨
â”‚   â”œâ”€â”€ api/              # API æŽ¥å£
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ routes/       # API è·¯ç”±ï¼ˆæŒ‰æ¨¡å—æ‹†åˆ†ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ anime.py          # åŠ¨ç”»ç›¸å…³è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ anime_extra.py    # åŠ¨ç”»æ‰©å±•è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ rss.py            # RSSæºè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ rss_extra.py      # RSSæºæ‰©å±•è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ link.py           # é“¾æŽ¥è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ link_extra.py     # é“¾æŽ¥æ‰©å±•è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ downloader.py     # ä¸‹è½½å™¨è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ download.py       # ä¸‹è½½ä»»åŠ¡è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler.py      # è°ƒåº¦æœåŠ¡è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ smart_parser.py   # æ™ºèƒ½è§£æžè·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ health.py         # å¥åº·æ£€æŸ¥è·¯ç”±
â”‚   â”‚   â””â”€â”€ schemas/      # Pydantic æ¨¡åž‹ï¼ˆæŒ‰æ¨¡å—æ‹†åˆ†ï¼‰
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ common.py         # é€šç”¨å“åº”æ¨¡åž‹
â”‚   â”‚       â”œâ”€â”€ anime.py          # åŠ¨ç”»ç›¸å…³æ¨¡åž‹
â”‚   â”‚       â”œâ”€â”€ rss.py            # RSSæºç›¸å…³æ¨¡åž‹
â”‚   â”‚       â”œâ”€â”€ link.py           # é“¾æŽ¥ç›¸å…³æ¨¡åž‹
â”‚   â”‚       â”œâ”€â”€ downloader.py     # ä¸‹è½½å™¨ç›¸å…³æ¨¡åž‹
â”‚   â”‚       â”œâ”€â”€ download.py       # ä¸‹è½½ä»»åŠ¡ç›¸å…³æ¨¡åž‹
â”‚   â”‚       â”œâ”€â”€ scheduler.py      # è°ƒåº¦æœåŠ¡ç›¸å…³æ¨¡åž‹
â”‚   â”‚       â””â”€â”€ smart_parser.py   # æ™ºèƒ½è§£æžç›¸å…³æ¨¡åž‹
â”‚   â”œâ”€â”€ database/         # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ session.py
â”‚   â”‚   â””â”€â”€ init_db.py
â”‚   â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config.py     # é…ç½®åŠ è½½
â”‚       â””â”€â”€ logger.py
â””â”€â”€ client/               # å®¢æˆ·ç«¯ä»£ç 
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ main.py           # å®¢æˆ·ç«¯å…¥å£
    â”œâ”€â”€ commands/         # CLI å‘½ä»¤
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ anime_commands.py     # åŠ¨ç”»å‘½ä»¤
    â”‚   â”œâ”€â”€ rss_commands.py       # RSSæºå‘½ä»¤
    â”‚   â”œâ”€â”€ link_commands.py      # é“¾æŽ¥å‘½ä»¤
    â”‚   â”œâ”€â”€ download_commands.py  # ä¸‹è½½å‘½ä»¤
    â”‚   â”œâ”€â”€ downloader_commands.py # ä¸‹è½½å™¨å‘½ä»¤
    â”‚   â””â”€â”€ status_commands.py    # çŠ¶æ€å‘½ä»¤
    â”œâ”€â”€ api/              # API å®¢æˆ·ç«¯
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ client.py
    â””â”€â”€ utils/            # å·¥å…·å‡½æ•°
        â”œâ”€â”€ __init__.py
        â””â”€â”€ config.py     # å®¢æˆ·ç«¯é…ç½®åŠ è½½

# ç”¨æˆ·ç›®å½•ï¼ˆé»˜è®¤é…ç½®ä½ç½®ï¼‰
~/.animeloader/
â”œâ”€â”€ server_config.yaml    # æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤ä½ç½®ï¼‰
â”œâ”€â”€ client_config.yaml    # å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤ä½ç½®ï¼‰
â”œâ”€â”€ data/                 # æ•°æ®åº“æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ animeloader.db
â”œâ”€â”€ downloads/            # ä¸‹è½½ç›®å½•
â””â”€â”€ logs/                 # æ—¥å¿—ç›®å½•
    â””â”€â”€ animeloader.log
```

## 3.5 ä»£ç æž¶æž„ä¼˜åŒ–

### 3.5.1 æ¨¡å—åŒ–è®¾è®¡

ä¸ºäº†æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œé¡¹ç›®é‡‡ç”¨äº†æ¨¡å—åŒ–çš„è®¾è®¡ï¼š

- **API è·¯ç”±æ¨¡å—åŒ–**ï¼šå°† API è·¯ç”±æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼ˆanimeã€rssã€linkã€downloaderã€downloadã€schedulerã€smart_parserã€healthï¼‰
- **Schemas æ¨¡å—åŒ–**ï¼šå°† Pydantic æ¨¡åž‹æŒ‰åŠŸèƒ½æ¨¡å—æ‹†åˆ†ä¸ºç‹¬ç«‹æ–‡ä»¶ï¼ˆcommonã€animeã€rssã€linkã€downloaderã€downloadã€schedulerã€smart_parserï¼‰
- **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**ï¼šæ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œä¾¿äºŽç»´æŠ¤å’Œæ‰©å±•

### 3.5.2 ä»£ç ç»„ç»‡åŽŸåˆ™

- **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ
- **é«˜å†…èšä½Žè€¦åˆ**ï¼šç›¸å…³åŠŸèƒ½ç»„ç»‡åœ¨ä¸€èµ·ï¼Œæ¨¡å—é—´ä¾èµ–æœ€å°åŒ–
- **æ˜“äºŽæ‰©å±•**ï¼šæ·»åŠ æ–°åŠŸèƒ½åªéœ€åˆ›å»ºæ–°çš„è·¯ç”±å’Œ schemas æ–‡ä»¶
- **æ¸…æ™°çš„å¯¼å…¥è·¯å¾„**ï¼šé€šè¿‡ `__init__.py` ç»Ÿä¸€å¯¼å‡ºï¼Œç®€åŒ–å¯¼å…¥

### 3.5.3 æ¨¡å—è¯´æ˜Ž

**API è·¯ç”±æ¨¡å—** (`server/api/routes/`)ï¼š
- `anime.py` - åŠ¨ç”»ç›¸å…³è·¯ç”±ï¼ˆCRUDã€æ™ºèƒ½è§£æžï¼‰
- `anime_extra.py` - åŠ¨ç”»æ‰©å±•è·¯ç”±ï¼ˆèŽ·å–RSSæºï¼‰
- `rss.py` - RSSæºç›¸å…³è·¯ç”±ï¼ˆCRUDï¼‰
- `rss_extra.py` - RSSæºæ‰©å±•è·¯ç”±ï¼ˆèŽ·å–é“¾æŽ¥ã€æ£€æŸ¥RSSï¼‰
- `link.py` - é“¾æŽ¥ç›¸å…³è·¯ç”±ï¼ˆCRUDï¼‰
- `link_extra.py` - é“¾æŽ¥æ‰©å±•è·¯ç”±ï¼ˆèŽ·å–ä¸‹è½½ä»»åŠ¡ï¼‰
- `downloader.py` - ä¸‹è½½å™¨ç›¸å…³è·¯ç”±ï¼ˆCRUDã€æµ‹è¯•ã€çŠ¶æ€ï¼‰
- `download.py` - ä¸‹è½½ä»»åŠ¡ç›¸å…³è·¯ç”±ï¼ˆCRUDã€æŽ§åˆ¶ï¼‰
- `scheduler.py` - è°ƒåº¦æœåŠ¡ç›¸å…³è·¯ç”±ï¼ˆä»»åŠ¡ç®¡ç†ï¼‰
- `smart_parser.py` - æ™ºèƒ½è§£æžç›¸å…³è·¯ç”±ï¼ˆè§£æžåŠ¨ç”»ï¼‰
- `health.py` - å¥åº·æ£€æŸ¥è·¯ç”±

**Schemas æ¨¡å—** (`server/api/schemas/`)ï¼š
- `common.py` - é€šç”¨å“åº”æ¨¡åž‹ï¼ˆMessageResponseã€ErrorResponseï¼‰
- `anime.py` - åŠ¨ç”»ç›¸å…³æ¨¡åž‹ï¼ˆAnimeBaseã€AnimeCreateã€AnimeResponseç­‰ï¼‰
- `rss.py` - RSSæºç›¸å…³æ¨¡åž‹ï¼ˆRSSSourceBaseã€RSSSourceCreateã€RSSSourceResponseç­‰ï¼‰
- `link.py` - é“¾æŽ¥ç›¸å…³æ¨¡åž‹ï¼ˆLinkBaseã€LinkCreateã€LinkResponseç­‰ï¼‰
- `downloader.py` - ä¸‹è½½å™¨ç›¸å…³æ¨¡åž‹ï¼ˆDownloaderBaseã€DownloaderCreateã€DownloaderResponseç­‰ï¼‰
- `download.py` - ä¸‹è½½ä»»åŠ¡ç›¸å…³æ¨¡åž‹ï¼ˆDownloadTaskBaseã€DownloadTaskCreateã€DownloadTaskResponseç­‰ï¼‰
- `scheduler.py` - è°ƒåº¦æœåŠ¡ç›¸å…³æ¨¡åž‹ï¼ˆSchedulerJobCreateã€SchedulerJobsResponseç­‰ï¼‰
- `smart_parser.py` - æ™ºèƒ½è§£æžç›¸å…³æ¨¡åž‹ï¼ˆSmartParseAnimeRequestã€SmartParseAnimeResponseç­‰ï¼‰

## 4. æœåŠ¡ç«¯è®¾è®¡

### 4.1 æ•°æ®æ¨¡åž‹

#### 4.1.1 Anime (åŠ¨ç”»ä¿¡æ¯)

```python
class Anime:
    id: int                    # ä¸»é”®
    title: str                 # åŠ¨ç”»æ ‡é¢˜
    title_en: str              # è‹±æ–‡æ ‡é¢˜
    description: str           # æè¿°
    cover_url: str             # å°é¢URL
    status: str                # çŠ¶æ€ (ongoing, completed, etc.)
    total_episodes: int        # æ€»é›†æ•°
    created_at: datetime       # åˆ›å»ºæ—¶é—´
    updated_at: datetime       # æ›´æ–°æ—¶é—´
```

#### 4.1.2 RSSSource (RSSè®¢é˜…æº)

```python
class RSSSource:
    id: int                    # ä¸»é”®
    anime_id: int              # åŠ¨ç”»ID (å¤–é”®)
    name: str                  # RSSæºåç§°
    url: str                   # RSSè®¢é˜…é“¾æŽ¥
    quality: str               # ç”»è´¨ (1080p, 720p, etc.)
    is_active: bool            # æ˜¯å¦æ¿€æ´»
    auto_download: bool        # æ˜¯å¦è‡ªåŠ¨ä¸‹è½½
    last_checked_at: datetime  # æœ€åŽæ£€æŸ¥æ—¶é—´
    created_at: datetime       # åˆ›å»ºæ—¶é—´
    updated_at: datetime       # æ›´æ–°æ—¶é—´
```

#### 4.1.3 Link (ä¸‹è½½é“¾æŽ¥)

```python
class Link:
    id: int                    # ä¸»é”®
    rss_source_id: int         # RSSæºID (å¤–é”®)
    episode_number: int        # é›†æ•°
    episode_title: str         # é›†æ ‡é¢˜
    link_type: str             # é“¾æŽ¥ç±»åž‹ (magnet, ed2k, http, ftp, etc.)
    url: str                   # é“¾æŽ¥åœ°å€
    file_size: int             # æ–‡ä»¶å¤§å° (bytes)
    publish_date: datetime     # å‘å¸ƒæ—¶é—´
    is_downloaded: bool        # æ˜¯å¦å·²ä¸‹è½½
    is_available: bool         # é“¾æŽ¥æ˜¯å¦å¯ç”¨
    meta_data: str             # å…ƒæ•°æ® (JSONæ ¼å¼ï¼Œå­˜å‚¨é“¾æŽ¥ç±»åž‹ç‰¹å®šä¿¡æ¯)
    created_at: datetime       # åˆ›å»ºæ—¶é—´
    updated_at: datetime       # æ›´æ–°æ—¶é—´
```

#### 4.1.4 Downloader (ä¸‹è½½å™¨é…ç½®)

```python
class Downloader:
    id: int                    # ä¸»é”®
    name: str                  # ä¸‹è½½å™¨åç§°
    downloader_type: str       # ä¸‹è½½å™¨ç±»åž‹ (aria2, pikpak, etc.)
    config: str                # é…ç½®ä¿¡æ¯ (JSONæ ¼å¼)
    is_active: bool            # æ˜¯å¦æ¿€æ´»
    is_default: bool           # æ˜¯å¦ä¸ºé»˜è®¤ä¸‹è½½å™¨
    max_concurrent_tasks: int  # æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°
    created_at: datetime       # åˆ›å»ºæ—¶é—´
    updated_at: datetime       # æ›´æ–°æ—¶é—´
```

#### 4.1.5 DownloadTask (ä¸‹è½½ä»»åŠ¡)

```python
class DownloadTask:
    id: int                    # ä¸»é”®
    link_id: int               # é“¾æŽ¥ID (å¤–é”®)
    rss_source_id: int         # RSSæºID (å¤–é”®)
    downloader_id: int         # ä¸‹è½½å™¨ID (å¤–é”®)
    downloader_type: str       # ä¸‹è½½å™¨ç±»åž‹ (å†—ä½™å­—æ®µï¼Œä¾¿äºŽæŸ¥è¯¢)
    file_path: str             # æœ¬åœ°ä¿å­˜è·¯å¾„
    status: str                # çŠ¶æ€ (pending, downloading, completed, failed, seeding)
    progress: float            # è¿›åº¦ (0-100)
    file_size: int             # æ–‡ä»¶å¤§å° (bytes)
    downloaded_size: int       # å·²ä¸‹è½½å¤§å° (bytes)
    download_speed: float      # ä¸‹è½½é€Ÿåº¦ (bytes/s)
    upload_speed: float        # ä¸Šä¼ é€Ÿåº¦ (bytes/s) - ç”¨äºŽBTç§å­
    error_message: str         # é”™è¯¯ä¿¡æ¯
    retry_count: int           # é‡è¯•æ¬¡æ•°
    task_id_external: str      # å¤–éƒ¨ä¸‹è½½å™¨ä»»åŠ¡ID (å¦‚aria2çš„gid)
    created_at: datetime       # åˆ›å»ºæ—¶é—´
    started_at: datetime       # å¼€å§‹æ—¶é—´
    completed_at: datetime     # å®Œæˆæ—¶é—´
```

### 4.2 æœåŠ¡æ¨¡å—

#### 4.2.1 AnimeService (åŠ¨ç”»ç®¡ç†æœåŠ¡) âœ…

- `create_anime(title, title_en, description, cover_url, status, total_episodes)` - åˆ›å»ºåŠ¨ç”»è®°å½•
- `get_anime(anime_id)` - èŽ·å–å•ä¸ªåŠ¨ç”»
- `get_animes(skip, limit, search, status)` - èŽ·å–åŠ¨ç”»åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢å’Œè¿‡æ»¤
- `update_anime(anime_id, **kwargs)` - æ›´æ–°åŠ¨ç”»ä¿¡æ¯
- `delete_anime(anime_id)` - åˆ é™¤åŠ¨ç”»
- `count_animes(search, status)` - ç»Ÿè®¡åŠ¨ç”»æ•°é‡

#### 4.2.2 RSSService (RSSæºç®¡ç†æœåŠ¡) âœ…

- `create_rss_source(anime_id, name, url, quality, is_active, auto_download)` - åˆ›å»ºRSSæºè®°å½•
- `get_rss_source(rss_source_id)` - èŽ·å–å•ä¸ªRSSæº
- `get_rss_sources(anime_id)` - èŽ·å–åŠ¨ç”»çš„æ‰€æœ‰RSSæº
- `update_rss_source(rss_source_id, **kwargs)` - æ›´æ–°RSSæºä¿¡æ¯
- `delete_rss_source(rss_source_id)` - åˆ é™¤RSSæº

#### 4.2.3 SmartParserService (æ™ºèƒ½è§£æžæœåŠ¡) âœ…

- `parse_anime(url: str) -> List[Dict]` - è§£æžåŠ¨ç”»é“¾æŽ¥ï¼Œè¿”å›žå¯èƒ½çš„åŠ¨ç”»ä¿¡æ¯åˆ—è¡¨
- `parse_rss(url: str, anime_id: int) -> List[Dict]` - è§£æžRSSé“¾æŽ¥ï¼Œè¿”å›žå¯èƒ½çš„RSSæºä¿¡æ¯åˆ—è¡¨ï¼ˆéœ€æŒ‡å®šæ‰€å±žåŠ¨ç”»ï¼‰
- `parse_anime_with_rss(url, auto_add_rss, anime_index, rss_indices, db)` - è§£æžåŠ¨ç”»é“¾æŽ¥å¹¶è‡ªåŠ¨è§£æžRSSæºï¼ˆè¿žé”è§£æžï¼‰ï¼Œå¹¶åˆ›å»ºåŠ¨ç”»è®°å½•
- `get_supported_sites() -> List[str]` - èŽ·å–æ”¯æŒçš„åŠ¨ç”»ç½‘ç«™åˆ—è¡¨
- `get_site_name_from_url(url: str) -> str` - æ ¹æ®URLèŽ·å–ç½‘ç«™åç§°
- `register_site_parser(parser)` - æ³¨å†Œæ–°çš„ç½‘ç«™è§£æžå™¨

#### 4.2.4 LinkService (é“¾æŽ¥ç®¡ç†æœåŠ¡) âœ…

- `add_link(rss_source_id, episode_number, episode_title, link_type, url, **kwargs)` - æ·»åŠ é“¾æŽ¥
- `get_links(skip, limit, is_downloaded=None, link_type=None, rss_source_id=None)` - èŽ·å–é“¾æŽ¥åˆ—è¡¨ï¼Œæ”¯æŒè¿‡æ»¤
- `get_link(link_id)` - èŽ·å–å•ä¸ªé“¾æŽ¥
- `mark_as_downloaded(link_id)` - æ ‡è®°é“¾æŽ¥ä¸ºå·²ä¸‹è½½
- `update_link_status(link_id, is_available)` - æ›´æ–°é“¾æŽ¥å¯ç”¨çŠ¶æ€
- `get_available_links(rss_source_id)` - èŽ·å–å¯ç”¨çš„ä¸‹è½½é“¾æŽ¥
- `filter_links_by_type(rss_source_id, link_type)` - æŒ‰é“¾æŽ¥ç±»åž‹è¿‡æ»¤
- `count_links(rss_source_id=None, is_downloaded=None, link_type=None)` - ç»Ÿè®¡é“¾æŽ¥æ•°é‡
- `delete_link(link_id)` - åˆ é™¤é“¾æŽ¥

#### 4.2.5 DownloadService (ä¸‹è½½æœåŠ¡) âœ…

- `create_download_task(link_id, rss_source_id, downloader_id=None)` - åˆ›å»ºä¸‹è½½ä»»åŠ¡
- `start_download(task_id)` - å¼€å§‹ä¸‹è½½
- `pause_download(task_id)` - æš‚åœä¸‹è½½
- `resume_download(task_id)` - æ¢å¤ä¸‹è½½
- `cancel_download(task_id)` - å–æ¶ˆä¸‹è½½
- `get_download_status(task_id)` - èŽ·å–ä¸‹è½½çŠ¶æ€
- `get_download_tasks(skip, limit, rss_source_id=None, link_id=None, status=None)` - èŽ·å–ä¸‹è½½ä»»åŠ¡åˆ—è¡¨ï¼Œæ”¯æŒè¿‡æ»¤
- `get_download_task(task_id)` - èŽ·å–å•ä¸ªä¸‹è½½ä»»åŠ¡
- `get_download_tasks_by_link(link_id)` - èŽ·å–é“¾æŽ¥çš„æ‰€æœ‰ä¸‹è½½ä»»åŠ¡
- `get_active_downloads()` - èŽ·å–æ‰€æœ‰æ´»è·ƒçš„ä¸‹è½½ä»»åŠ¡
- `sync_download_status(task_id)` - åŒæ­¥ä¸‹è½½å™¨çŠ¶æ€åˆ°æœ¬åœ°
- `count_download_tasks(rss_source_id=None, link_id=None, status=None)` - ç»Ÿè®¡ä¸‹è½½ä»»åŠ¡æ•°é‡
- `delete_download_task(task_id)` - åˆ é™¤ä¸‹è½½ä»»åŠ¡

#### 4.2.6 DownloaderService (ä¸‹è½½å™¨ç®¡ç†æœåŠ¡) âœ…

- `add_downloader(name, downloader_type, config, is_default=False, max_concurrent_tasks=3)` - æ·»åŠ ä¸‹è½½å™¨
- `remove_downloader(downloader_id)` - åˆ é™¤ä¸‹è½½å™¨
- `update_downloader(downloader_id, **kwargs)` - æ›´æ–°ä¸‹è½½å™¨é…ç½®
- `get_downloaders(skip, limit)` - èŽ·å–ä¸‹è½½å™¨åˆ—è¡¨
- `get_downloader(downloader_id)` - èŽ·å–å•ä¸ªä¸‹è½½å™¨
- `get_default_downloader()` - èŽ·å–é»˜è®¤ä¸‹è½½å™¨
- `set_default_downloader(downloader_id)` - è®¾ç½®é»˜è®¤ä¸‹è½½å™¨
- `get_downloader_by_type(downloader_type)` - æ ¹æ®ç±»åž‹èŽ·å–ä¸‹è½½å™¨
- `test_downloader(downloader_id)` - æµ‹è¯•ä¸‹è½½å™¨è¿žæŽ¥
- `get_downloader_status(downloader_id)` - èŽ·å–ä¸‹è½½å™¨çŠ¶æ€ï¼ˆå½“å‰ä»»åŠ¡æ•°ç­‰ï¼‰
- `get_supported_downloader_types()` - èŽ·å–æ”¯æŒçš„ä¸‹è½½å™¨ç±»åž‹åˆ—è¡¨
- `validate_downloader_config(downloader_type, config)` - éªŒè¯ä¸‹è½½å™¨é…ç½®

#### 4.2.7 SchedulerService (è°ƒåº¦æœåŠ¡) âœ…

- `start_scheduler()` - å¯åŠ¨è°ƒåº¦å™¨
- `stop_scheduler()` - åœæ­¢è°ƒåº¦å™¨
- `add_check_job(rss_source_id, interval)` - æ·»åŠ RSSæºæ£€æŸ¥ä»»åŠ¡
- `remove_check_job(job_id)` - ç§»é™¤æ£€æŸ¥ä»»åŠ¡
- `pause_job(job_id)` - æš‚åœä»»åŠ¡
- `resume_job(job_id)` - æ¢å¤ä»»åŠ¡
- `get_jobs()` - èŽ·å–æ‰€æœ‰ä»»åŠ¡
- `get_job(job_id)` - èŽ·å–å•ä¸ªä»»åŠ¡
- `check_rss_source(rss_source_id, auto_download=False)` - æ£€æŸ¥RSSæºçš„æ–°é“¾æŽ¥
- `is_running()` - æ£€æŸ¥è°ƒåº¦å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ

#### 4.2.8 LinkParserService (é“¾æŽ¥è§£æžæœåŠ¡ - å¯æ‰©å±•) ðŸ“‹

*è®¡åˆ’ä¸­ - åŠŸèƒ½å°šæœªå®žçŽ°*

- `parse_link(link_type, url)` - æ ¹æ®é“¾æŽ¥ç±»åž‹è§£æžé“¾æŽ¥
- `get_parser(link_type)` - èŽ·å–å¯¹åº”é“¾æŽ¥ç±»åž‹çš„è§£æžå™¨
- `register_parser(link_type, parser_class)` - æ³¨å†Œæ–°çš„é“¾æŽ¥ç±»åž‹è§£æžå™¨
- `validate_link(link_type, url)` - éªŒè¯é“¾æŽ¥æ ¼å¼æ˜¯å¦æ­£ç¡®

#### 4.2.9 DownloaderManagerService (ä¸‹è½½å™¨ç®¡ç†æœåŠ¡ - å¯æ‰©å±•) ðŸ“‹

*è®¡åˆ’ä¸­ - åŠŸèƒ½å°šæœªå®žçŽ°*

- `get_downloader(downloader_type)` - èŽ·å–å¯¹åº”ç±»åž‹çš„ä¸‹è½½å™¨å®žä¾‹
- `register_downloader(downloader_type, downloader_class)` - æ³¨å†Œæ–°çš„ä¸‹è½½å™¨ç±»åž‹
- `get_supported_downloader_types()` - èŽ·å–æ”¯æŒçš„ä¸‹è½½å™¨ç±»åž‹åˆ—è¡¨
- `validate_downloader_config(downloader_type, config)` - éªŒè¯ä¸‹è½½å™¨é…ç½®

æ™ºèƒ½è§£æžæœåŠ¡ç”¨äºŽä»ŽåŠ¨ç”»ç½‘ç«™é“¾æŽ¥è‡ªåŠ¨è§£æžåŠ¨ç”»ä¿¡æ¯å’ŒRSSè®¢é˜…é“¾æŽ¥ä¿¡æ¯ã€‚

- `parse_anime(url: str) -> List[Dict]` - è§£æžåŠ¨ç”»é“¾æŽ¥ï¼Œè¿”å›žå¯èƒ½çš„åŠ¨ç”»ä¿¡æ¯åˆ—è¡¨
- `parse_rss(url: str, anime_id: int) -> List[Dict]` - è§£æžRSSé“¾æŽ¥ï¼Œè¿”å›žå¯èƒ½çš„RSSæºä¿¡æ¯åˆ—è¡¨ï¼ˆéœ€æŒ‡å®šæ‰€å±žåŠ¨ç”»ï¼‰
- `parse_anime_with_rss(url: str, auto_add_rss: bool = True) -> Dict` - è§£æžåŠ¨ç”»é“¾æŽ¥å¹¶è‡ªåŠ¨è§£æžRSSæºï¼ˆè¿žé”è§£æžï¼‰
- `get_supported_sites() -> List[str]` - èŽ·å–æ”¯æŒçš„åŠ¨ç”»ç½‘ç«™åˆ—è¡¨
- `register_site_parser(site_name: str, parser_class)` - æ³¨å†Œæ–°çš„ç½‘ç«™è§£æžå™¨

**æ™ºèƒ½è§£æžæµç¨‹ï¼š**

1. **åŠ¨ç”»æ™ºèƒ½è§£æž**ï¼š
   - ç”¨æˆ·æä¾›ä¸€ä¸ªåŠ¨ç”»ç½‘ç«™é“¾æŽ¥
   - ç³»ç»Ÿè¯†åˆ«ç½‘ç«™ç±»åž‹å¹¶è°ƒç”¨å¯¹åº”çš„è§£æžå™¨
   - è§£æžå™¨æå–åŠ¨ç”»åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æè¿°ã€å°é¢ç­‰ï¼‰
   - å¦‚æžœè§£æžç»“æžœæœ‰å¤šä¸ªï¼Œè¿”å›žåˆ—è¡¨ä¾›ç”¨æˆ·é€‰æ‹©
   - ç”¨æˆ·é€‰æ‹©åŽï¼Œç³»ç»Ÿåˆ›å»ºåŠ¨ç”»è®°å½•
   - å¦‚æžœå¯ç”¨è¿žé”è§£æžï¼Œè‡ªåŠ¨è§£æžè¯¥åŠ¨ç”»ä¸‹çš„RSSæº

2. **RSSæºæ™ºèƒ½è§£æž**ï¼š
   - ç”¨æˆ·æä¾›ä¸€ä¸ªRSSç½‘ç«™é“¾æŽ¥ï¼Œå¹¶æŒ‡å®šæ‰€å±žçš„åŠ¨ç”»
   - ç³»ç»Ÿè¯†åˆ«ç½‘ç«™ç±»åž‹å¹¶è°ƒç”¨å¯¹åº”çš„è§£æžå™¨
   - è§£æžå™¨æå–RSSæºä¿¡æ¯ï¼ˆåç§°ã€URLã€ç”»è´¨ç­‰ï¼‰
   - å¦‚æžœè§£æžç»“æžœæœ‰å¤šä¸ªï¼Œè¿”å›žåˆ—è¡¨ä¾›ç”¨æˆ·é€‰æ‹©
   - ç”¨æˆ·é€‰æ‹©åŽï¼Œç³»ç»Ÿåˆ›å»ºRSSæºè®°å½•

**æ”¯æŒçš„ç½‘ç«™ï¼š**
- https://mikanani.me/ï¼ˆèœœæŸ‘è®¡åˆ’ï¼‰

**ç½‘ç«™è§£æžå™¨æŽ¥å£è®¾è®¡ï¼š**
```python
class BaseSiteParser(ABC):
    @abstractmethod
    def can_parse(self, url: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦å¯ä»¥è§£æžè¯¥URL"""
        pass

    @abstractmethod
    def parse_anime(self, url: str) -> List[Dict]:
        """è§£æžåŠ¨ç”»ä¿¡æ¯ï¼Œè¿”å›žå¯èƒ½çš„åŠ¨ç”»åˆ—è¡¨"""
        pass

    @abstractmethod
    def parse_rss(self, url: str, anime_id: int) -> List[Dict]:
        """è§£æžRSSæºä¿¡æ¯ï¼Œè¿”å›žå¯èƒ½çš„RSSæºåˆ—è¡¨"""
        pass

    @abstractmethod
    def get_site_name(self) -> str:
        """èŽ·å–ç½‘ç«™åç§°"""
        pass
```

**æ™ºèƒ½è§£æžè¿”å›žæ•°æ®æ ¼å¼ï¼š**

åŠ¨ç”»ä¿¡æ¯æ ¼å¼ï¼š
```python
{
    'title': 'é¬¼ç­ä¹‹åˆƒ',
    'title_en': 'Demon Slayer',
    'description': 'åŠ¨ç”»æè¿°',
    'cover_url': 'https://example.com/cover.jpg',
    'status': 'ongoing',
    'total_episodes': 12,
    'rss_sources': [  # å¯é€‰ï¼Œå¦‚æžœè§£æžå™¨èƒ½åŒæ—¶è§£æžRSS
        {
            'name': 'èœœæŸ‘è®¡åˆ’ 1080P',
            'url': 'https://mikanani.me/RSS/Bangumi/12345',
            'quality': '1080p'
        }
    ]
}
```

RSSæºä¿¡æ¯æ ¼å¼ï¼š
```python
{
    'name': 'èœœæŸ‘è®¡åˆ’ 1080P',
    'url': 'https://mikanani.me/RSS/Bangumi/12345',
    'quality': '1080p',
    'auto_download': True
}
```

### 4.3 API æŽ¥å£

#### RESTful API è®¾è®¡

**å·²å®žçŽ°çš„ APIï¼š**

```
# åŠ¨ç”»ç›¸å…³ âœ…
GET    /api/anime                   # èŽ·å–åŠ¨ç”»åˆ—è¡¨ï¼Œæ”¯æŒæœç´¢å’Œè¿‡æ»¤
GET    /api/anime/{anime_id}        # èŽ·å–åŠ¨ç”»è¯¦æƒ…
POST   /api/anime                   # åˆ›å»ºåŠ¨ç”»
PUT    /api/anime/{anime_id}        # æ›´æ–°åŠ¨ç”»
DELETE /api/anime/{anime_id}        # åˆ é™¤åŠ¨ç”»
POST   /api/anime/smart-parse       # æ™ºèƒ½è§£æžåŠ¨ç”»ä¿¡æ¯
POST   /api/anime/smart-add         # æ™ºèƒ½æ·»åŠ åŠ¨ç”»ï¼ˆæ”¯æŒè¿žé”è§£æžRSSï¼‰

# RSSæºç›¸å…³ âœ…
GET    /api/anime/{anime_id}/rss-sources  # èŽ·å–åŠ¨ç”»çš„æ‰€æœ‰RSSæº
GET    /api/rss-sources/{rss_source_id}   # èŽ·å–å•ä¸ªRSSæº
POST   /api/rss-sources            # åˆ›å»ºRSSæº
PUT    /api/rss-sources/{rss_source_id}   # æ›´æ–°RSSæº
DELETE /api/rss-sources/{rss_source_id}   # åˆ é™¤RSSæº

# æ™ºèƒ½è§£æžç›¸å…³ âœ…
GET    /api/smart-parser/sites     # èŽ·å–æ”¯æŒçš„ç½‘ç«™åˆ—è¡¨
POST   /api/smart-parser/parse-anime  # è§£æžåŠ¨ç”»é“¾æŽ¥
POST   /api/smart-parser/parse-rss    # è§£æžRSSé“¾æŽ¥ï¼ˆå¾…å®žçŽ°ï¼‰

# å¥åº·æ£€æŸ¥ âœ…
GET    /api/health                  # å¥åº·æ£€æŸ¥
```

**è®¡åˆ’ä¸­çš„ APIï¼š**

```
# RSSæºç›¸å…³ ðŸ“‹
POST   /api/rss-sources/{id}/check  # æ‰‹åŠ¨æ£€æŸ¥RSSæºæ–°é“¾æŽ¥ âœ…
POST   /api/rss-sources/smart-parse # æ™ºèƒ½è§£æžRSSæºä¿¡æ¯ ðŸ“‹
POST   /api/rss-sources/smart-add   # æ™ºèƒ½æ·»åŠ RSSæº ðŸ“‹

# é“¾æŽ¥ç›¸å…³ âœ…
GET    /api/rss-sources/{id}/links  # èŽ·å–RSSæºçš„æ‰€æœ‰é“¾æŽ¥ï¼ˆåŒ…å«ä¸‹è½½çŠ¶æ€ï¼‰
GET    /api/links/{id}              # èŽ·å–å•ä¸ªé“¾æŽ¥
GET    /api/links                   # èŽ·å–é“¾æŽ¥åˆ—è¡¨ï¼ˆæ”¯æŒè¿‡æ»¤ï¼‰
POST   /api/links/{id}/mark-downloaded  # æ ‡è®°ä¸ºå·²ä¸‹è½½

# ä¸‹è½½å™¨ç›¸å…³ âœ…
GET    /api/downloaders             # èŽ·å–æ‰€æœ‰ä¸‹è½½å™¨
POST   /api/downloaders             # æ·»åŠ ä¸‹è½½å™¨
GET    /api/downloaders/{id}        # èŽ·å–å•ä¸ªä¸‹è½½å™¨
PUT    /api/downloaders/{id}        # æ›´æ–°ä¸‹è½½å™¨
DELETE /api/downloaders/{id}        # åˆ é™¤ä¸‹è½½å™¨
POST   /api/downloaders/{id}/test   # æµ‹è¯•ä¸‹è½½å™¨è¿žæŽ¥
POST   /api/downloaders/{id}/set-default  # è®¾ç½®ä¸ºé»˜è®¤ä¸‹è½½å™¨
GET    /api/downloaders/default     # èŽ·å–é»˜è®¤ä¸‹è½½å™¨
GET    /api/downloaders/types       # èŽ·å–æ”¯æŒçš„ä¸‹è½½å™¨ç±»åž‹

# ä¸‹è½½ä»»åŠ¡ç›¸å…³ âœ…
GET    /api/downloads               # èŽ·å–æ‰€æœ‰ä¸‹è½½ä»»åŠ¡
GET    /api/downloads/{id}          # èŽ·å–å•ä¸ªä¸‹è½½ä»»åŠ¡
POST   /api/downloads               # åˆ›å»ºä¸‹è½½ä»»åŠ¡
POST   /api/downloads/{id}/start    # å¼€å§‹ä¸‹è½½
POST   /api/downloads/{id}/pause    # æš‚åœä¸‹è½½
POST   /api/downloads/{id}/resume   # æ¢å¤ä¸‹è½½
POST   /api/downloads/{id}/cancel   # å–æ¶ˆä¸‹è½½
POST   /api/downloads/{id}/sync     # åŒæ­¥ä¸‹è½½çŠ¶æ€
GET    /api/downloads/active        # èŽ·å–æ‰€æœ‰æ´»è·ƒçš„ä¸‹è½½ä»»åŠ¡
GET    /api/links/{id}/downloads    # èŽ·å–é“¾æŽ¥çš„æ‰€æœ‰ä¸‹è½½ä»»åŠ¡

# è°ƒåº¦ç›¸å…³ âœ…
POST   /api/scheduler/start         # å¯åŠ¨è°ƒåº¦å™¨
POST   /api/scheduler/stop          # åœæ­¢è°ƒåº¦å™¨
GET    /api/scheduler/jobs          # èŽ·å–æ‰€æœ‰ä»»åŠ¡
POST   /api/scheduler/jobs          # æ·»åŠ ä»»åŠ¡
DELETE /api/scheduler/jobs/{id}     # ç§»é™¤ä»»åŠ¡
POST   /api/scheduler/jobs/{id}/pause    # æš‚åœä»»åŠ¡
POST   /api/scheduler/jobs/{id}/resume   # æ¢å¤ä»»åŠ¡
```

## 5. å®¢æˆ·ç«¯è®¾è®¡

### 5.1 æ™ºèƒ½è§£æžç”¨æˆ·ä½“éªŒ

æ™ºèƒ½è§£æžåŠŸèƒ½é€šè¿‡äº¤äº’å¼çš„æ–¹å¼ä¸ºç”¨æˆ·æä¾›ä¾¿æ·çš„æ·»åŠ ä½“éªŒã€‚å½“ç”¨æˆ·ä½¿ç”¨ `smart-add` å‘½ä»¤æ—¶ï¼Œç³»ç»Ÿä¼šï¼š

1. **è§£æžé“¾æŽ¥**ï¼šè‡ªåŠ¨è¯†åˆ«ç½‘ç«™ç±»åž‹å¹¶æå–ä¿¡æ¯
2. **æ˜¾ç¤ºé€‰é¡¹**ï¼šå¦‚æžœè§£æžç»“æžœæœ‰å¤šä¸ªï¼Œä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºä¾›ç”¨æˆ·é€‰æ‹©
3. **äº¤äº’é€‰æ‹©**ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥æ•°å­—æˆ–èŒƒå›´ï¼ˆå¦‚ 1,2,3 æˆ– 1-3ï¼‰é€‰æ‹©å¤šä¸ªé€‰é¡¹
4. **ç¡®è®¤æ·»åŠ **ï¼šæ˜¾ç¤ºå³å°†æ·»åŠ çš„ä¿¡æ¯ï¼Œç”¨æˆ·ç¡®è®¤åŽæ‰§è¡Œæ·»åŠ æ“ä½œ
5. **è¿žé”æ“ä½œ**ï¼šå¯¹äºŽåŠ¨ç”»æ™ºèƒ½è§£æžï¼Œå¯é€‰æ‹©æ˜¯å¦ç»§ç»­è§£æžRSSæº

**äº¤äº’å¼é€‰æ‹©ç¤ºä¾‹ï¼š**
```
æ­£åœ¨è§£æžé“¾æŽ¥: https://mikanani.me/Home/Bangumi/12345
æ‰¾åˆ° 2 ä¸ªå¯èƒ½çš„åŠ¨ç”»ï¼š

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ æ ‡é¢˜                               â”‚ è‹±æ–‡æ ‡é¢˜                 â”‚ çŠ¶æ€   â”‚ é›†æ•°   â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚ é¬¼ç­ä¹‹åˆƒ                           â”‚ Demon Slayer             â”‚ è¿žè½½ä¸­ â”‚ 12é›†   â”‚
â”‚  2 â”‚ é¬¼ç­ä¹‹åˆƒ æŸ±è®­ç»ƒç¯‡                  â”‚ Demon Slayer: Hashira    â”‚ è¿žè½½ä¸­ â”‚ 8é›†    â”‚
â”‚    â”‚                                    â”‚ Training Arc             â”‚        â”‚        â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯·é€‰æ‹©è¦æ·»åŠ çš„åŠ¨ç”»ï¼ˆè¾“å…¥IDï¼Œå¦‚ 1ï¼‰ï¼š1

âœ“ åŠ¨ç”»æ·»åŠ æˆåŠŸï¼šé¬¼ç­ä¹‹åˆƒ

æ˜¯å¦è‡ªåŠ¨è§£æžRSSæºï¼Ÿ[Y/n]: y

æ‰¾åˆ° 3 ä¸ªRSSæºï¼š

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ åç§°           â”‚ ç”»è´¨     â”‚ è‡ªåŠ¨ä¸‹è½½         â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚ èœœæŸ‘è®¡åˆ’ 1080P â”‚ 1080p    â”‚ æ˜¯               â”‚
â”‚  2 â”‚ èœœæŸ‘è®¡åˆ’ 720P  â”‚ 720p     â”‚ æ˜¯               â”‚
â”‚  3 â”‚ èœœæŸ‘è®¡åˆ’ 480P  â”‚ 480p     â”‚ æ˜¯               â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯·é€‰æ‹©è¦æ·»åŠ çš„RSSæºï¼ˆå¯å¤šé€‰ï¼Œå¦‚ 1,2 æˆ– 1-3ï¼‰ï¼š1,2

âœ“ RSSæºæ·»åŠ æˆåŠŸï¼šèœœæŸ‘è®¡åˆ’ 1080P
âœ“ RSSæºæ·»åŠ æˆåŠŸï¼šèœœæŸ‘è®¡åˆ’ 720P
```

### 5.2 CLI å‘½ä»¤ç»“æž„

åŸºäºŽ **cmd2** æ¡†æž¶æž„å»ºå‘½ä»¤è¡Œæž¶æž„ï¼Œæä¾›äº¤äº’å¼ Shell çŽ¯å¢ƒï¼Œå¹¶é›†æˆ **rich** åº“è¿›è¡Œç•Œé¢ç¾ŽåŒ–ï¼Œæ”¯æŒè¡¨æ ¼ã€è¿›åº¦æ¡ã€å½©è‰²è¾“å‡ºã€è¯­æ³•é«˜äº®ç­‰ä¸°å¯Œçš„è§†è§‰æ•ˆæžœã€‚

**æŠ€æœ¯æ ˆç»„åˆè¯´æ˜Žï¼š**
- **cmd2**: è´Ÿè´£å‘½ä»¤è§£æžã€å‚æ•°å¤„ç†ã€å‘½ä»¤è·¯ç”±ã€äº¤äº’å¼ Shell ç­‰æ ¸å¿ƒåŠŸèƒ½
- **rich**: è´Ÿè´£è¾“å‡ºç¾ŽåŒ–ã€è¡¨æ ¼æ¸²æŸ“ã€è¿›åº¦æ¡æ˜¾ç¤ºã€é¢œè‰²ä¸»é¢˜ç­‰è§†è§‰æ•ˆæžœ

**å½“å‰å®žçŽ°çš„å‘½ä»¤ï¼š**

```
animeloader> help
Documented commands (type help <topic>):
========================================
anime       åŠ¨ç”»ç›¸å…³å‘½ä»¤ âœ… (éƒ¨åˆ†å®žçŽ°)
rss         RSSæºç›¸å…³å‘½ä»¤ ðŸ“‹
link        é“¾æŽ¥ç›¸å…³å‘½ä»¤ ðŸ“‹
downloader  ä¸‹è½½å™¨ç›¸å…³å‘½ä»¤ ðŸ“‹
download    ä¸‹è½½ç›¸å…³å‘½ä»¤ ðŸ“‹
status      çŠ¶æ€æŸ¥è¯¢å‘½ä»¤ ðŸ“‹
config      æŸ¥çœ‹å½“å‰é…ç½® âœ…
exit/quit   é€€å‡ºç¨‹åº âœ…
clear       æ¸…å± âœ…
```

**åŠ¨ç”»å‘½ä»¤ (anime) âœ…ï¼š**

```
animeloader> anime <å­å‘½ä»¤> [é€‰é¡¹]

å­å‘½ä»¤:
  add         æ·»åŠ åŠ¨ç”» âœ…
  list        åˆ—å‡ºæ‰€æœ‰åŠ¨ç”» âœ…
  show        æ˜¾ç¤ºåŠ¨ç”»è¯¦æƒ… âœ…
  smart-add   æ™ºèƒ½æ·»åŠ åŠ¨ç”»ï¼ˆä»Žé“¾æŽ¥è‡ªåŠ¨è§£æžï¼‰âœ…

ç¤ºä¾‹:
  animeloader> anime add --title "é¬¼ç­ä¹‹åˆƒ" --title-en "Demon Slayer"
  animeloader> anime list --keyword "é¬¼ç­"
  animeloader> anime show --id 1
  animeloader> anime smart-add --url "https://mikanani.me/Home/Bangumi/12345"
```

**RSSæºå‘½ä»¤ (rss) ðŸ“‹ï¼š**

```
animeloader> rss <å­å‘½ä»¤> [é€‰é¡¹]

å­å‘½ä»¤:
  add         æ·»åŠ RSSæº ðŸ“‹
  smart-add   æ™ºèƒ½æ·»åŠ RSSæºï¼ˆä»Žé“¾æŽ¥è‡ªåŠ¨è§£æžï¼‰ðŸ“‹
  list        åˆ—å‡ºRSSæº ðŸ“‹
  remove      åˆ é™¤RSSæº ðŸ“‹
  update      æ›´æ–°RSSæº ðŸ“‹
  check       æ‰‹åŠ¨æ£€æŸ¥RSSæºæ–°é“¾æŽ¥ ðŸ“‹
  show        æ˜¾ç¤ºRSSæºè¯¦æƒ… ðŸ“‹
```

**é“¾æŽ¥å‘½ä»¤ (link) ðŸ“‹ï¼š**

```
animeloader> link <å­å‘½ä»¤> [é€‰é¡¹]

å­å‘½ä»¤:
  list    åˆ—å‡ºé“¾æŽ¥ ðŸ“‹
  show    æ˜¾ç¤ºé“¾æŽ¥è¯¦æƒ… ðŸ“‹
  filter  æŒ‰ç±»åž‹è¿‡æ»¤é“¾æŽ¥ ðŸ“‹
```

**ä¸‹è½½å™¨å‘½ä»¤ (downloader) ðŸ“‹ï¼š**

```
animeloader> downloader <å­å‘½ä»¤> [é€‰é¡¹]

å­å‘½ä»¤:
  add          æ·»åŠ ä¸‹è½½å™¨ ðŸ“‹
  list         åˆ—å‡ºä¸‹è½½å™¨ ðŸ“‹
  remove       åˆ é™¤ä¸‹è½½å™¨ ðŸ“‹
  update       æ›´æ–°ä¸‹è½½å™¨ ðŸ“‹
  show         æ˜¾ç¤ºä¸‹è½½å™¨è¯¦æƒ… ðŸ“‹
  test         æµ‹è¯•ä¸‹è½½å™¨è¿žæŽ¥ ðŸ“‹
  set-default  è®¾ç½®é»˜è®¤ä¸‹è½½å™¨ ðŸ“‹
  types        æŸ¥çœ‹æ”¯æŒçš„ä¸‹è½½å™¨ç±»åž‹ ðŸ“‹
```

**ä¸‹è½½å‘½ä»¤ (download) ðŸ“‹ï¼š**

```
animeloader> download <å­å‘½ä»¤> [é€‰é¡¹]

å­å‘½ä»¤:
  list    åˆ—å‡ºä¸‹è½½ä»»åŠ¡ ðŸ“‹
  pause   æš‚åœä¸‹è½½ ðŸ“‹
  resume  æ¢å¤ä¸‹è½½ ðŸ“‹
  start   å¼€å§‹ä¸‹è½½ ðŸ“‹
  cancel  å–æ¶ˆä¸‹è½½ ðŸ“‹
  status  æŸ¥çœ‹ä¸‹è½½çŠ¶æ€ ðŸ“‹
  sync    åŒæ­¥ä¸‹è½½çŠ¶æ€ ðŸ“‹
```

**çŠ¶æ€å‘½ä»¤ (status) ðŸ“‹ï¼š**

```
animeloader> status <å­å‘½ä»¤> [é€‰é¡¹]

å­å‘½ä»¤:
  server  æŸ¥çœ‹æœåŠ¡å™¨çŠ¶æ€ ðŸ“‹
  system  æŸ¥çœ‹ç³»ç»Ÿä¿¡æ¯ ðŸ“‹
```

### 5.3 å‘½ä»¤ç¤ºä¾‹

**å·²å®žçŽ°çš„å‘½ä»¤ï¼š**

```bash
# æ·»åŠ åŠ¨ç”»
animeloader> anime add --title "é¬¼ç­ä¹‹åˆƒ" --title-en "Demon Slayer" --description "é¬¼ç­ä¹‹åˆƒ"

# æ™ºèƒ½æ·»åŠ åŠ¨ç”»ï¼ˆä»Žé“¾æŽ¥è‡ªåŠ¨è§£æžï¼‰
animeloader> anime smart-add --url "https://mikanani.me/Home/Bangumi/12345"
# ç³»ç»Ÿä¼šè‡ªåŠ¨è§£æžé“¾æŽ¥ï¼Œæå–åŠ¨ç”»ä¿¡æ¯
# å¦‚æžœè§£æžç»“æžœæœ‰å¤šä¸ªï¼Œä¼šæ˜¾ç¤ºåˆ—è¡¨ä¾›ç”¨æˆ·é€‰æ‹©ï¼š
# â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ ID â”‚ æ ‡é¢˜           â”‚ è‹±æ–‡æ ‡é¢˜                 â”‚ çŠ¶æ€   â”‚ é›†æ•°   â”‚
# â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  1 â”‚ é¬¼ç­ä¹‹åˆƒ       â”‚ Demon Slayer             â”‚ è¿žè½½ä¸­ â”‚ 12é›†   â”‚
# â”‚  2 â”‚ é¬¼ç­ä¹‹åˆƒ æŸ±è®­ç»ƒç¯‡ â”‚ Demon Slayer: Hashira  â”‚ è¿žè½½ä¸­ â”‚ 8é›†    â”‚
# â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# è¯·é€‰æ‹©è¦æ·»åŠ çš„åŠ¨ç”»ï¼ˆè¾“å…¥IDï¼Œå¦‚ 1ï¼‰ï¼š1
# âœ“ åŠ¨ç”»æ·»åŠ æˆåŠŸï¼šé¬¼ç­ä¹‹åˆƒ
# æ˜¯å¦è‡ªåŠ¨è§£æžRSSæºï¼Ÿ[Y/n]: y
# æ‰¾åˆ° 3 ä¸ªRSSæºï¼š
# â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ ID â”‚ åç§°           â”‚ ç”»è´¨     â”‚ è‡ªåŠ¨ä¸‹è½½         â”‚
# â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
# â”‚  1 â”‚ èœœæŸ‘è®¡åˆ’ 1080P â”‚ 1080p    â”‚ æ˜¯               â”‚
# â”‚  2 â”‚ èœœæŸ‘è®¡åˆ’ 720P  â”‚ 720p     â”‚ æ˜¯               â”‚
# â”‚  3 â”‚ èœœæŸ‘è®¡åˆ’ 480P  â”‚ 480p     â”‚ æ˜¯               â”‚
# â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# è¯·é€‰æ‹©è¦æ·»åŠ çš„RSSæºï¼ˆå¯å¤šé€‰ï¼Œå¦‚ 1,2 æˆ– 1-3ï¼‰ï¼š1,2
# âœ“ RSSæºæ·»åŠ æˆåŠŸï¼šèœœæŸ‘è®¡åˆ’ 1080P
# âœ“ RSSæºæ·»åŠ æˆåŠŸï¼šèœœæŸ‘è®¡åˆ’ 720P

# åˆ—å‡ºåŠ¨ç”»
animeloader> anime list

# æœç´¢åŠ¨ç”»
animeloader> anime list --keyword "é¬¼ç­"

# æ˜¾ç¤ºåŠ¨ç”»è¯¦æƒ…
animeloader> anime show --id 1

# æŸ¥çœ‹å½“å‰é…ç½®
animeloader> config

# æ¸…å±
animeloader> clear

# é€€å‡ºç¨‹åº
animeloader> exit
# æˆ–
animeloader> quit
```

**è®¡åˆ’ä¸­çš„å‘½ä»¤ï¼š**

```bash
# RSSæºç›¸å…³å‘½ä»¤ï¼ˆè®¡åˆ’ä¸­ï¼‰
animeloader> rss add --anime-id 1 --name "DMHY 1080P" --url "https://example.com/rss" --quality 1080p
animeloader> rss smart-add --url "https://mikanani.me/RSS/Bangumi/12345" --anime-id 1
animeloader> rss list --anime-id 1
animeloader> rss show --id 1
animeloader> rss update --id 1 --quality 720p
animeloader> rss remove --id 1
animeloader> rss check --id 1

# é“¾æŽ¥ç›¸å…³å‘½ä»¤ï¼ˆè®¡åˆ’ä¸­ï¼‰
animeloader> link list --rss-source-id 1
animeloader> link filter --rss-source-id 1 --link-type magnet
animeloader> link show --id 1

# ä¸‹è½½å™¨ç›¸å…³å‘½ä»¤ï¼ˆè®¡åˆ’ä¸­ï¼‰
animeloader> downloader add --name "æœ¬åœ°aria2" --type aria2 --config '{"host": "127.0.0.1", "port": 6800}'
animeloader> downloader list
animeloader> downloader show --id 1
animeloader> downloader test --id 1
animeloader> downloader set-default --id 1
animeloader> downloader types
animeloader> downloader remove --id 1

# ä¸‹è½½ç›¸å…³å‘½ä»¤ï¼ˆè®¡åˆ’ä¸­ï¼‰
animeloader> download start --link-id 1
animeloader> download list
animeloader> download pause --task-id 1
animeloader> download resume --task-id 1
animeloader> download cancel --task-id 1
animeloader> download status --task-id 1
animeloader> download sync --task-id 1

# çŠ¶æ€æŸ¥è¯¢å‘½ä»¤ï¼ˆè®¡åˆ’ä¸­ï¼‰
animeloader> status server
animeloader> status system
```

## 6. æ•°æ®åº“è®¾è®¡

### 6.1 æ•°æ®åº“åˆå§‹åŒ–

```sql
-- åˆ›å»ºè¡¨æ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ
-- ä½¿ç”¨ SQLAlchemy ORM è‡ªåŠ¨ç®¡ç†
```

### 6.2 ç´¢å¼•è®¾è®¡

```python
# RSSSource è¡¨
Index('idx_rss_source_anime_id', RSSSource.anime_id)
Index('idx_rss_source_is_active', RSSSource.is_active)

# Link è¡¨
Index('idx_link_rss_source_id', Link.rss_source_id)
Index('idx_link_type', Link.link_type)
Index('idx_link_is_downloaded', Link.is_downloaded)
Index('idx_link_is_available', Link.is_available)
Index('idx_link_publish_date', Link.publish_date)

# Downloader è¡¨
Index('idx_downloader_type', Downloader.downloader_type)
Index('idx_downloader_is_active', Downloader.is_active)
Index('idx_downloader_is_default', Downloader.is_default)

# DownloadTask è¡¨
Index('idx_download_rss_source_id', DownloadTask.rss_source_id)
Index('idx_download_link_id', DownloadTask.link_id)
Index('idx_download_downloader_id', DownloadTask.downloader_id)
Index('idx_download_downloader_type', DownloadTask.downloader_type)
Index('idx_download_status', DownloadTask.status)
```

## 7. é…ç½®ç®¡ç†

### 7.1 é…ç½®æ–‡ä»¶åˆ†ç¦»

ç³»ç»Ÿé‡‡ç”¨åˆ†ç¦»çš„é…ç½®æ–‡ä»¶è®¾è®¡ï¼š
- **æœåŠ¡ç«¯é…ç½®**ï¼šå¯ç”±ç”¨æˆ·æŒ‡å®šä½ç½®ï¼ˆé»˜è®¤ä¸º `~/.animeloader/server_config.yaml`ï¼‰ï¼Œå­˜å‚¨æœåŠ¡ç«¯è¿è¡Œæ‰€éœ€çš„é…ç½®ï¼ŒåŒ…æ‹¬æ•°æ®åº“è·¯å¾„ã€ä¸‹è½½ç›®å½•ç­‰
- **å®¢æˆ·ç«¯é…ç½®** (`client_config.yaml`)ï¼šå¯ç”±å®¢æˆ·ç«¯éšæ„æŒ‡å®šä½ç½®ï¼Œå­˜å‚¨å®¢æˆ·ç«¯è¿žæŽ¥å’Œæ˜¾ç¤ºè®¾ç½®

### 7.2 æœåŠ¡ç«¯é…ç½®æ–‡ä»¶

æœåŠ¡ç«¯é…ç½®æ–‡ä»¶å¯ç”±ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šä½ç½®ï¼ˆé»˜è®¤ä¸º `~/.animeloader/server_config.yaml`ï¼‰ï¼Œå­˜å‚¨æœåŠ¡ç«¯è¿è¡Œæ‰€éœ€çš„é…ç½®ï¼ŒåŒ…æ‹¬æ•°æ®åº“è·¯å¾„ã€ä¸‹è½½ç›®å½•ç­‰ã€‚

```yaml
# ~/.animeloader/server_config.yaml
server:
  host: "127.0.0.1"
  port: 8000
  debug: false

database:
  path: "~/.animeloader/data/animeloader.db"  # æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤åœ¨ç”¨æˆ·ç›®å½•ä¸‹

rss:
  check_interval: 3600      # RSSæ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
  timeout: 30               # RSSè¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰
  max_links_per_source: 100 # æ¯ä¸ªRSSæºä¿ç•™çš„æœ€å¤§é“¾æŽ¥æ•°
  link_retention_days: 30   # é“¾æŽ¥ä¿ç•™å¤©æ•°

download:
  download_dir: "~/.animeloader/downloads"  # ä¸‹è½½ç›®å½•ï¼Œé»˜è®¤åœ¨ç”¨æˆ·ç›®å½•ä¸‹
  max_concurrent_downloads: 3
  chunk_size: 8192
  retry_count: 3            # ä¸‹è½½å¤±è´¥é‡è¯•æ¬¡æ•°
  retry_interval: 60        # é‡è¯•é—´éš”ï¼ˆç§’ï¼‰
  auto_sync_interval: 30    # è‡ªåŠ¨åŒæ­¥ä¸‹è½½çŠ¶æ€é—´éš”ï¼ˆç§’ï¼‰

link_types:
  enabled:
    - magnet                # æ”¯æŒçš„é“¾æŽ¥ç±»åž‹
    - ed2k
  parsers:
    magnet: "server.link_parsers.magnet_parser.MagnetParser"
    ed2k: "server.link_parsers.ed2k_parser.Ed2kParser"

downloaders:
  enabled:
    - aria2                 # æ”¯æŒçš„ä¸‹è½½å™¨ç±»åž‹
    - pikpak
  implementations:
    aria2: "server.downloaders.aria2_downloader.Aria2Downloader"
    pikpak: "server.downloaders.pikpak_downloader.PikPakDownloader"
  default_type: aria2       # é»˜è®¤ä¸‹è½½å™¨ç±»åž‹

# aria2 é»˜è®¤é…ç½®æ¨¡æ¿
aria2:
  host: "127.0.0.1"
  port: 6800
  secret: ""
  timeout: 30

# pikpak é»˜è®¤é…ç½®æ¨¡æ¿
pikpak:
  api_endpoint: "https://api-drive.mypikpak.com"  # PikPak APIåœ°å€
  username: ""
  password: ""
  timeout: 60

scheduler:
  enabled: true

smart_parser:
  timeout: 30                # ç½‘ç«™è§£æžè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  user_agent: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"  # ç”¨æˆ·ä»£ç†
  max_results: 10            # æœ€å¤§è¿”å›žç»“æžœæ•°
  auto_add_rss: true         # æ™ºèƒ½æ·»åŠ åŠ¨ç”»æ—¶æ˜¯å¦è‡ªåŠ¨è§£æžRSSæº

logging:
  level: "INFO"
  file: "~/.animeloader/logs/animeloader.log"  # æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤åœ¨ç”¨æˆ·ç›®å½•ä¸‹
  max_bytes: 10485760  # 10MB
  backup_count: 5
```

### 7.3 å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶

å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶å¯ç”±ç”¨æˆ·éšæ„æŒ‡å®šä½ç½®ï¼ˆé»˜è®¤ä¸º `~/.animeloader/client_config.yaml`ï¼‰ï¼ŒåŒ…å«è¿žæŽ¥æœåŠ¡å™¨å’Œæ˜¾ç¤ºç›¸å…³çš„é…ç½®ã€‚

```yaml
# client_config.yaml
server:
  url: "http://127.0.0.1:8000"  # æœåŠ¡ç«¯URL
  timeout: 30                    # è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  retry_count: 3                 # è¯·æ±‚å¤±è´¥é‡è¯•æ¬¡æ•°

display:
  theme: "auto"                  # ä¸»é¢˜: auto, light, dark
  table_max_rows: 20             # è¡¨æ ¼é»˜è®¤æ˜¾ç¤ºçš„æœ€å¤§è¡Œæ•°
  show_progress: true            # æ˜¯å¦æ˜¾ç¤ºä¸‹è½½è¿›åº¦æ¡
  refresh_interval: 5            # è‡ªåŠ¨åˆ·æ–°é—´éš”ï¼ˆç§’ï¼Œç”¨äºŽå®žæ—¶çŠ¶æ€ç›‘æŽ§ï¼‰
  
  # é¢œè‰²é…ç½®
  colors:
    success: "green"
    error: "red"
    warning: "yellow"
    info: "blue"
    download_speed: "cyan"
    upload_speed: "magenta"

ui:
  use_rich: true                 # æ˜¯å¦ä½¿ç”¨ rich åº“è¿›è¡Œç¾ŽåŒ–æ˜¾ç¤º
  use_cmd2: true                 # æ˜¯å¦ä½¿ç”¨ cmd2 æ¡†æž¶ï¼ˆå¯ç”¨äº¤äº’å¼ Shellï¼‰
  emoji: true                    # æ˜¯å¦åœ¨è¾“å‡ºä¸­ä½¿ç”¨ emoji
  compact_mode: false            # ç´§å‡‘æ¨¡å¼ï¼ˆå‡å°‘ç©ºç™½è¡Œï¼‰
  verbose: false                 # è¯¦ç»†è¾“å‡ºæ¨¡å¼
  
  # cmd2 é€‰é¡¹
  cmd2:
    allow_cli_args: true         # å…è®¸å‘½ä»¤è¡Œå‚æ•°
    shortcuts: true              # å¯ç”¨å¿«æ·é”®
    persistent_history_file: "~/.animeloader/.cmd2_history"  # å‘½ä»¤åŽ†å²æ–‡ä»¶

logging:
  level: "INFO"                  # å®¢æˆ·ç«¯æ—¥å¿—çº§åˆ«
  file: ""                       # å®¢æˆ·ç«¯æ—¥å¿—æ–‡ä»¶è·¯å¾„ï¼ˆç©ºåˆ™ä¸è®°å½•æ–‡ä»¶ï¼‰

smart_parser:
  auto_select: false             # å½“åªæœ‰ä¸€ä¸ªè§£æžç»“æžœæ—¶æ˜¯å¦è‡ªåŠ¨é€‰æ‹©
  show_details: true             # æ˜¯å¦æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
  confirm_before_add: true       # æ·»åŠ å‰æ˜¯å¦è¦æ±‚ç¡®è®¤
```

### 7.4 é…ç½®æ–‡ä»¶åŠ è½½ä¼˜å…ˆçº§

**æœåŠ¡ç«¯é…ç½®åŠ è½½é¡ºåºï¼š**
1. å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šçš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆ`--config`ï¼‰
2. `~/.animeloader/server_config.yaml`ï¼ˆç”¨æˆ·ä¸»ç›®å½•ï¼‰
3. `server_config.yaml`ï¼ˆç›¸å¯¹äºŽé¡¹ç›®æ ¹ç›®å½•ï¼Œä»…ç”¨äºŽå¼€å‘çŽ¯å¢ƒï¼‰
4. çŽ¯å¢ƒå˜é‡è¦†ç›–ï¼ˆå¯é€‰ï¼‰

**å®¢æˆ·ç«¯é…ç½®åŠ è½½é¡ºåºï¼š**
1. å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šçš„é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆ`--config`ï¼‰
2. `~/.animeloader/client_config.yaml`ï¼ˆç”¨æˆ·ä¸»ç›®å½•ï¼‰
3. `client_config.yaml`ï¼ˆç›¸å¯¹äºŽé¡¹ç›®æ ¹ç›®å½•ï¼Œä»…ç”¨äºŽå¼€å‘çŽ¯å¢ƒï¼‰
4. çŽ¯å¢ƒå˜é‡è¦†ç›–ï¼ˆå¯é€‰ï¼‰

## 8. éƒ¨ç½²æ–¹æ¡ˆ

### 8.1 å¼€å‘çŽ¯å¢ƒ

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆå§‹åŒ–æ•°æ®åº“
python -m server.database.init_db

# å¯åŠ¨æœåŠ¡ç«¯ï¼ˆä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„ server_config.yamlï¼‰
python -m server.main

# å¯åŠ¨æœåŠ¡ç«¯ï¼ˆæŒ‡å®šé…ç½®æ–‡ä»¶ï¼‰
python -m server.main --config /path/to/custom_config.yaml

# å¯åŠ¨å®¢æˆ·ç«¯ï¼ˆä½¿ç”¨é¡¹ç›®æ ¹ç›®å½•çš„ client_config.yamlï¼‰
python -m client.main

# å¯åŠ¨å®¢æˆ·ç«¯ï¼ˆæŒ‡å®šé…ç½®æ–‡ä»¶ï¼‰
python -m client.main --config /path/to/custom_config.yaml

# æ·»åŠ é»˜è®¤ä¸‹è½½å™¨ï¼ˆå¯é€‰ï¼‰
animeloader> downloader add --name "æœ¬åœ°aria2" --type aria2 --config '{"host": "127.0.0.1", "port": 6800, "secret": ""}' --default
```

### 8.2 ç”Ÿäº§çŽ¯å¢ƒ

**æœåŠ¡ç«¯éƒ¨ç½²ï¼š**
```bash
# åˆ›å»ºæœåŠ¡ç«¯é…ç½®ç›®å½•
mkdir -p ~/.animeloader

# å¤åˆ¶æˆ–åˆ›å»ºé…ç½®æ–‡ä»¶
cp server_config.yaml ~/.animeloader/server_config.yaml

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®æ•°æ®åº“è·¯å¾„ã€ä¸‹è½½ç›®å½•ç­‰
vim ~/.animeloader/server_config.yaml

# ä½¿ç”¨ systemd ç®¡ç†
# /etc/systemd/system/animeloader.service

[Unit]
Description=AnimeLoader Server
After=network.target

[Service]
Type=simple
User=anime
WorkingDirectory=/opt/animeloader
ExecStart=/usr/bin/python3 -m server.main --config /home/anime/.animeloader/server_config.yaml
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

**å®¢æˆ·ç«¯éƒ¨ç½²ï¼š**
å®¢æˆ·ç«¯å¯éƒ¨ç½²åœ¨ä»»ä½•èƒ½è®¿é—®æœåŠ¡ç«¯çš„æœºå™¨ä¸Šï¼Œé…ç½®æ–‡ä»¶ä½ç½®å¯è‡ªç”±æŒ‡å®šï¼š

```bash
# åˆ›å»ºå®¢æˆ·ç«¯é…ç½®ç›®å½•
mkdir -p ~/.animeloader

# å¤åˆ¶æˆ–åˆ›å»ºé…ç½®æ–‡ä»¶
cp client_config.yaml ~/.animeloader/

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®æœåŠ¡ç«¯åœ°å€
vim ~/.animeloader/client_config.yaml

# å¯åŠ¨å®¢æˆ·ç«¯
python -m client.main
```

## 9. æ‰©å±•æ€§è€ƒè™‘

### 9.1 å¤šç”¨æˆ·æ”¯æŒ

- æ·»åŠ ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- å®žçŽ°ç”¨æˆ·æƒé™ç®¡ç†
- æ”¯æŒå¤šç”¨æˆ·ç‹¬ç«‹è®¢é˜…

### 9.2 é“¾æŽ¥ç±»åž‹æ‰©å±•

ç³»ç»Ÿé‡‡ç”¨æ’ä»¶åŒ–çš„è§£æžå™¨æž¶æž„ï¼Œæ”¯æŒçµæ´»æ‰©å±•æ–°çš„é“¾æŽ¥ç±»åž‹ï¼š

**è§£æžå™¨æŽ¥å£è®¾è®¡ï¼š**
```python
class BaseParser(ABC):
    @abstractmethod
    def parse(self, url: str) -> dict:
        """è§£æžé“¾æŽ¥ï¼Œè¿”å›žé“¾æŽ¥å…ƒæ•°æ®"""
        pass

    @abstractmethod
    def validate(self, url: str) -> bool:
        """éªŒè¯é“¾æŽ¥æ ¼å¼æ˜¯å¦æ­£ç¡®"""
        pass

    @abstractmethod
    def get_download_command(self, url: str, save_path: str) -> str:
        """èŽ·å–ä¸‹è½½å‘½ä»¤"""
        pass
```

**æ·»åŠ æ–°é“¾æŽ¥ç±»åž‹çš„æ­¥éª¤ï¼š**
1. åœ¨ `server/link_parsers/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è§£æžå™¨ç±»ï¼Œç»§æ‰¿ `BaseParser`
2. å®žçŽ°æŠ½è±¡æ–¹æ³•ï¼š`parse()`, `validate()`, `get_download_command()`
3. åœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œæ–°é“¾æŽ¥ç±»åž‹
4. åœ¨ `Link.link_type` ä¸­æ·»åŠ æ–°ç±»åž‹

**ç¤ºä¾‹ï¼šæ·»åŠ  HTTP é“¾æŽ¥æ”¯æŒ**
```python
# server/link_parsers/http_parser.py
class HttpParser(BaseParser):
    def parse(self, url: str) -> dict:
        # è§£æžHTTPé“¾æŽ¥
        return {"file_size": 0, "filename": ""}

    def validate(self, url: str) -> bool:
        return url.startswith("http://") or url.startswith("https://")

    def get_download_command(self, url: str, save_path: str) -> str:
        return f"wget -O {save_path} {url}"
```

### 9.3 ä¸‹è½½å™¨ç±»åž‹æ‰©å±•

ç³»ç»Ÿé‡‡ç”¨æ’ä»¶åŒ–çš„ä¸‹è½½å™¨æž¶æž„ï¼Œæ”¯æŒçµæ´»æ‰©å±•æ–°çš„ä¸‹è½½å™¨ç±»åž‹ï¼š

**ä¸‹è½½å™¨æŽ¥å£è®¾è®¡ï¼š**
```python
class BaseDownloader(ABC):
    @abstractmethod
    def connect(self, config: dict) -> bool:
        """è¿žæŽ¥åˆ°ä¸‹è½½å™¨"""
        pass

    @abstractmethod
    def disconnect(self) -> bool:
        """æ–­å¼€è¿žæŽ¥"""
        pass

    @abstractmethod
    def add_task(self, url: str, options: dict) -> str:
        """æ·»åŠ ä¸‹è½½ä»»åŠ¡ï¼Œè¿”å›žä»»åŠ¡ID"""
        pass

    @abstractmethod
    def remove_task(self, task_id: str) -> bool:
        """ç§»é™¤ä¸‹è½½ä»»åŠ¡"""
        pass

    @abstractmethod
    def pause_task(self, task_id: str) -> bool:
        """æš‚åœä¸‹è½½ä»»åŠ¡"""
        pass

    @abstractmethod
    def resume_task(self, task_id: str) -> bool:
        """æ¢å¤ä¸‹è½½ä»»åŠ¡"""
        pass

    @abstractmethod
    def get_task_status(self, task_id: str) -> dict:
        """èŽ·å–ä»»åŠ¡çŠ¶æ€"""
        pass

    @abstractmethod
    def get_global_status(self) -> dict:
        """èŽ·å–ä¸‹è½½å™¨å…¨å±€çŠ¶æ€"""
        pass

    @abstractmethod
    def validate_config(self, config: dict) -> tuple[bool, str]:
        """éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œè¿”å›ž(æ˜¯å¦æœ‰æ•ˆ, é”™è¯¯ä¿¡æ¯)"""
        pass
```

**æ·»åŠ æ–°ä¸‹è½½å™¨ç±»åž‹çš„æ­¥éª¤ï¼š**
1. åœ¨ `server/downloaders/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ä¸‹è½½å™¨ç±»ï¼Œç»§æ‰¿ `BaseDownloader`
2. å®žçŽ°æŠ½è±¡æ–¹æ³•ï¼š`connect()`, `disconnect()`, `add_task()`, `remove_task()`, `pause_task()`, `resume_task()`, `get_task_status()`, `get_global_status()`, `validate_config()`
3. åœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œæ–°ä¸‹è½½å™¨ç±»åž‹
4. åœ¨ `Downloader.downloader_type` ä¸­æ·»åŠ æ–°ç±»åž‹

**ç¤ºä¾‹ï¼šæ·»åŠ  qBittorrent ä¸‹è½½å™¨æ”¯æŒ**
```python
# server/downloaders/qbittorrent_downloader.py
class QBittorrentDownloader(BaseDownloader):
    def __init__(self):
        self.client = None

    def connect(self, config: dict) -> bool:
        from qbittorrentapi import Client
        self.client = Client(
            host=config.get('host', 'localhost'),
            port=config.get('port', 8080),
            username=config.get('username', ''),
            password=config.get('password', '')
        )
        try:
            self.client.auth_log_in()
            return True
        except Exception as e:
            return False

    def disconnect(self) -> bool:
        if self.client:
            self.client.auth_log_out()
        return True

    def add_task(self, url: str, options: dict) -> str:
        torrent = self.client.torrents_add(urls=[url], **options)
        return torrent

    def remove_task(self, task_id: str) -> bool:
        self.client.torrents_delete(delete_files=False, torrent_hashes=task_id)
        return True

    def pause_task(self, task_id: str) -> bool:
        self.client.torrents_pause(torrent_hashes=task_id)
        return True

    def resume_task(self, task_id: str) -> bool:
        self.client.torrents_resume(torrent_hashes=task_id)
        return True

    def get_task_status(self, task_id: str) -> dict:
        torrents = self.client.torrents_info(torrent_hashes=task_id)
        if torrents:
            t = torrents[0]
            return {
                'status': t.state,
                'progress': t.progress * 100,
                'download_speed': t.dlspeed,
                'upload_speed': t.upspeed,
                'downloaded_size': t.downloaded,
                'file_size': t.size
            }
        return {}

    def get_global_status(self) -> dict:
        info = self.client.transfer_info()
        return {
            'download_speed': info.dl_info_speed,
            'upload_speed': info.up_info_speed,
            'active_downloads': len(self.client.torrents_info(status_filter='downloading'))
        }

    def validate_config(self, config: dict) -> tuple[bool, str]:
        required_keys = ['host', 'port', 'username', 'password']
        for key in required_keys:
            if key not in config:
                return False, f"Missing required config key: {key}"
        return True, ""
```

### 9.4 å¤šæºæ”¯æŒ

- æŠ½è±¡æ¥æºæŽ¥å£
- æ”¯æŒå¤šä¸ªåŠ¨ç”»æ¥æºç«™ç‚¹
- å®žçŽ°æ¥æºæ’ä»¶æœºåˆ¶

### 9.5 ç½‘ç«™è§£æžå™¨æ‰©å±•

ç³»ç»Ÿé‡‡ç”¨æ’ä»¶åŒ–çš„ç½‘ç«™è§£æžå™¨æž¶æž„ï¼Œæ”¯æŒçµæ´»æ‰©å±•æ–°çš„åŠ¨ç”»ç½‘ç«™ï¼š

**ç½‘ç«™è§£æžå™¨æŽ¥å£è®¾è®¡ï¼š**
```python
class BaseSiteParser(ABC):
    @abstractmethod
    def can_parse(self, url: str) -> bool:
        """åˆ¤æ–­æ˜¯å¦å¯ä»¥è§£æžè¯¥URL"""
        pass

    @abstractmethod
    def parse_anime(self, url: str) -> List[Dict]:
        """è§£æžåŠ¨ç”»ä¿¡æ¯ï¼Œè¿”å›žå¯èƒ½çš„åŠ¨ç”»åˆ—è¡¨"""
        pass

    @abstractmethod
    def parse_rss(self, url: str, anime_id: int) -> List[Dict]:
        """è§£æžRSSæºä¿¡æ¯ï¼Œè¿”å›žå¯èƒ½çš„RSSæºåˆ—è¡¨"""
        pass

    @abstractmethod
    def get_site_name(self) -> str:
        """èŽ·å–ç½‘ç«™åç§°"""
        pass
```

**æ·»åŠ æ–°ç½‘ç«™æ”¯æŒçš„æ­¥éª¤ï¼š**
1. åœ¨ `server/site_parsers/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„ç½‘ç«™è§£æžå™¨ç±»ï¼Œç»§æ‰¿ `BaseSiteParser`
2. å®žçŽ°æŠ½è±¡æ–¹æ³•ï¼š`can_parse()`, `parse_anime()`, `parse_rss()`, `get_site_name()`
3. åœ¨æ™ºèƒ½è§£æžæœåŠ¡ä¸­æ³¨å†Œæ–°ç½‘ç«™è§£æžå™¨
4. æ›´æ–°æ”¯æŒçš„ç½‘ç«™åˆ—è¡¨

**ç¤ºä¾‹ï¼šæ·»åŠ  DMHY æ”¯æŒå™¨**
```python
# server/site_parsers/dmhy_parser.py
class DMHYParser(BaseSiteParser):
    def can_parse(self, url: str) -> bool:
        return 'dmhy.org' in url

    def parse_anime(self, url: str) -> List[Dict]:
        # è§£æžDMHYåŠ¨ç”»é¡µé¢
        return [
            {
                'title': 'åŠ¨ç”»æ ‡é¢˜',
                'title_en': 'English Title',
                'description': 'æè¿°',
                'cover_url': 'å°é¢URL',
                'status': 'ongoing',
                'total_episodes': 12
            }
        ]

    def parse_rss(self, url: str, anime_id: int) -> List[Dict]:
        # è§£æžDMHY RSSé¡µé¢
        return [
            {
                'name': 'DMHY 1080P',
                'url': 'RSSé“¾æŽ¥',
                'quality': '1080p',
                'auto_download': True
            }
        ]

    def get_site_name(self) -> str:
        return "DMHY"
```

### 9.6 åˆ†å¸ƒå¼ä¸‹è½½

- æ”¯æŒå¤šèŠ‚ç‚¹éƒ¨ç½²
- å®žçŽ°ä»»åŠ¡åˆ†å‘
- è´Ÿè½½å‡è¡¡

## 10. å®‰å…¨è€ƒè™‘

### 10.1 æ•°æ®å®‰å…¨

- æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- å®šæœŸæ•°æ®åº“å¤‡ä»½
- è®¿é—®æ—¥å¿—è®°å½•

### 10.2 ç½‘ç»œå®‰å…¨

- HTTPS åŠ å¯†ä¼ è¾“
- API è®¿é—®é™æµ
- è¾“å…¥éªŒè¯å’Œè¿‡æ»¤

## 11. æµ‹è¯•ç­–ç•¥

### 11.1 å•å…ƒæµ‹è¯•

- æµ‹è¯•å„ä¸ªæœåŠ¡æ¨¡å—
- æµ‹è¯•æ•°æ®åº“æ“ä½œ
- æµ‹è¯•ä¸šåŠ¡é€»è¾‘
- æµ‹è¯•æ™ºèƒ½è§£æžæœåŠ¡ï¼ˆç½‘ç«™è§£æžå™¨ã€é“¾æŽ¥è§£æžç­‰ï¼‰
- æµ‹è¯•é…ç½®åŠ è½½å’Œè·¯å¾„å±•å¼€

### 11.2 é›†æˆæµ‹è¯•

- æµ‹è¯• API æŽ¥å£
- æµ‹è¯•å®¢æˆ·ç«¯-æœåŠ¡ç«¯äº¤äº’
- æµ‹è¯•ä¸‹è½½æµç¨‹
- æµ‹è¯•æ™ºèƒ½æ·»åŠ æµç¨‹ï¼ˆåŠ¨ç”»å’ŒRSSæºçš„æ™ºèƒ½è§£æžï¼‰
- æµ‹è¯•å¤šé€‰æ‹©äº¤äº’é€»è¾‘

### 11.3 æµ‹è¯•è¦†ç›–çŽ‡ç›®æ ‡

- æ ¸å¿ƒåŠŸèƒ½: 80%+
- ä¸šåŠ¡é€»è¾‘: 70%+
- æ™ºèƒ½è§£æž: 75%+
- æ•´ä½“: 60%+